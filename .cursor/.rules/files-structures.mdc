---
alwaysApply: true
---

---

## ğŸ“ Structure de fichiers des Features

Chaque feature suit un **pattern standardisÃ©** avec un composant Smart Ã  la racine et des dossiers organisÃ©s par responsabilitÃ©.

### ğŸ¯ Pattern Smart Component + Dossiers

Chaque feature est organisÃ©e selon cette structure :

```
src/app/features/
â””â”€â”€ [feature-name]/                    # Nom de la feature (ex: create, edit, all)
    â”‚
    â”œâ”€â”€ [feature-name].component.ts    # ğŸ¯ SMART COMPONENT (point d'entrÃ©e)
    â”œâ”€â”€ [feature-name].component.html   # Template du composant principal
    â”œâ”€â”€ [feature-name].component.css   # Styles du composant principal
    â”œâ”€â”€ [feature-name].component.spec.ts # Tests du composant principal
    â”‚
    â”œâ”€â”€ components/                     # ğŸ“¦ Composants UI et logique
    â”‚   â”œâ”€â”€ application/                # Orchestration mÃ©tier (Facade Pattern)
    â”‚   â”‚   â”œâ”€â”€ application.ts
    â”‚   â”‚   â””â”€â”€ application.spec.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ infrastructure/             # Wrapper API (Adapter Pattern)
    â”‚   â”‚   â”œâ”€â”€ infrastructure.ts
    â”‚   â”‚   â””â”€â”€ infrastructure.spec.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ [ui-component-name]/       # Composants UI de prÃ©sentation
    â”‚   â”‚   â”œâ”€â”€ [name].component.ts
    â”‚   â”‚   â”œâ”€â”€ [name].component.html
    â”‚   â”‚   â”œâ”€â”€ [name].component.css
    â”‚   â”‚   â””â”€â”€ [name].component.spec.ts
    â”‚   â”‚
    â”‚   â””â”€â”€ lazy-[component-name]/     # Composants lazy-loaded
    â”‚       â””â”€â”€ lazy-[name].component.ts
    â”‚
    â”œâ”€â”€ services/                       # ğŸ”§ Services mÃ©tier de la feature
    â”‚   â”œâ”€â”€ [service-name]/
    â”‚   â”‚   â”œâ”€â”€ [service-name].service.ts
    â”‚   â”‚   â””â”€â”€ [service-name].service.spec.ts
    â”‚   â””â”€â”€ [autre-service]/
    â”‚       â””â”€â”€ ...
    â”‚
    â”œâ”€â”€ store/                          # ğŸ—„ï¸ Store NgRx Signals
    â”‚   â””â”€â”€ index.ts                    # Store principal de la feature
    â”‚
    â”œâ”€â”€ types/                          # ğŸ“ Types TypeScript de la feature
    â”‚   â”œâ”€â”€ [entity].ts                 # Interfaces et types
    â”‚   â”œâ”€â”€ [autre-type].ts
    â”‚   â””â”€â”€ ...
    â”‚
    â””â”€â”€ utils/                          # ğŸ› ï¸ Utilitaires de la feature
        â”œâ”€â”€ [util-name].ts
        â”œâ”€â”€ [util-name].spec.ts
        â””â”€â”€ ...
```

---

### ğŸ“‹ DÃ©tail de chaque Ã©lÃ©ment

#### 1ï¸âƒ£ **Smart Component** (composant principal)

**Fichier** : `[feature-name].component.ts`

**ResponsabilitÃ©** :

- âœ… Point d'entrÃ©e de la feature
- âœ… Injection du store et des services
- âœ… Gestion de l'affichage (signals pour toggle sections)
- âœ… Computed signals pour optimiser les calculs
- âœ… DÃ©lÃ©gation de la logique mÃ©tier Ã  `Application`

**CaractÃ©ristiques** :

- Composant **standalone**
- Utilise `inject()` pour les dÃ©pendances
- Signals pour la rÃ©activitÃ© UI
- Computed signals pour les calculs dÃ©rivÃ©s

**Exemple** :

```typescript
@Component({
  selector: 'app-create',
  standalone: true,
  imports: [CommonModule, FormsModule, ...],
  templateUrl: './create.component.html',
  styleUrl: './create.component.css'
})
export class CreateComponent {
  // Injection des dÃ©pendances
  private readonly application = inject(Application);
  private readonly loggingService = inject(LoggingService);
  readonly store = inject(SearchStore);

  // Ã‰tat local pour l'UI
  articleIdea = '';

  // Signals pour contrÃ´ler l'affichage
  readonly showEditor = signal(true);
  readonly showErrors = signal(true);

  // Computed signals pour optimiser
  readonly articleStats = computed(() => {
    const article = this.store.article() || '';
    return {
      characters: article.length,
      words: article.split(/\s+/).filter(w => w.length > 0).length
    };
  });

  // MÃ©thodes publiques
  generate() {
    this.application.generate(this.articleIdea);
  }
}
```

---

#### 2ï¸âƒ£ **Dossier `components/`** - Composants et logique

**Structure** :

```
components/
â”œâ”€â”€ application/          # Orchestration mÃ©tier (Facade)
â”œâ”€â”€ infrastructure/       # Wrapper API (Adapter)
â”œâ”€â”€ [ui-component]/       # Composants UI de prÃ©sentation
â””â”€â”€ lazy-[component]/     # Composants lazy-loaded
```

##### **`application/`** - Orchestration mÃ©tier

**Fichier** : `components/application/application.ts`

**ResponsabilitÃ©** :

- âœ… Coordonne le workflow de la feature
- âœ… Utilise `effect()` pour rÃ©agir aux changements du store
- âœ… Appelle les mÃ©thodes du store selon l'Ã©tat
- âœ… Simplifie l'interface pour le Smart Component

**Pattern** : Facade Pattern

**Exemple** :

```typescript
@Injectable({ providedIn: "root" })
export class Application {
  private readonly store = inject(SearchStore);

  constructor() {
    effect(() => {
      const step = this.store.step();

      if (step === 1) {
        this.store.enrichMediaParallel();
      } else if (step === 2) {
        this.store.setInternalLink();
      }
    });
  }

  generate(articleIdea: string): void {
    this.store.initializeAndGenerate(articleIdea);
  }
}
```

##### **`infrastructure/`** - Wrapper API

**Fichier** : `components/infrastructure/infrastructure.ts`

**ResponsabilitÃ©** :

- âœ… Encapsule les appels aux services API
- âœ… Gestion d'erreurs standardisÃ©e
- âœ… Transformation des erreurs en format uniforme
- âœ… Logging systÃ©matique

**Pattern** : Adapter Pattern

**Exemple** :

```typescript
@Injectable({ providedIn: "root" })
export class Infrastructure {
  private readonly supabaseService = inject(SupabaseService);
  private readonly openaiApiService = inject(OpenaiApiService);

  setPost(idea: string): Observable<any | PostgrestError> {
    return this.wrapWithErrorHandling(
      () => this.openaiApiService.generateArticle(idea),
      "setPost",
      "GÃ©nÃ©ration article"
    );
  }

  private wrapWithErrorHandling<T>(
    operation: () => Observable<T>,
    methodName: string,
    context: string
  ): Observable<T | PostgrestError> {
    return operation().pipe(
      catchError((error) => {
        const postgrestError = this.handleError(error, context, methodName);
        return of(postgrestError);
      })
    );
  }
}
```

##### **Composants UI** - PrÃ©sentation

**Structure** : Un dossier par composant UI

**Exemple** :

```
components/
â”œâ”€â”€ article-editor/
â”‚   â”œâ”€â”€ article-editor.component.ts
â”‚   â”œâ”€â”€ article-editor.component.html
â”‚   â”œâ”€â”€ article-editor.component.css
â”‚   â””â”€â”€ article-editor.component.spec.ts
â”œâ”€â”€ error-display/
â”‚   â””â”€â”€ ...
â””â”€â”€ performance-display/
    â””â”€â”€ ...
```

**CaractÃ©ristiques** :

- Composants **standalone**
- ResponsabilitÃ© unique (Single Responsibility)
- RÃ©utilisables et testables
- Peuvent Ãªtre lazy-loaded si volumineux

##### **Composants lazy-loaded**

**Structure** : `lazy-[component-name]/`

**Exemple** :

```typescript
// lazy-article-editor.component.ts
import { Component } from "@angular/core";

@Component({
  selector: "app-lazy-article-editor",
  standalone: true,
  template: "",
  imports: [],
})
export class LazyArticleEditorComponent {
  // Wrapper pour lazy loading
  static load() {
    return import("../article-editor/article-editor.component").then(
      (m) => m.ArticleEditorComponent
    );
  }
}
```

**Usage dans le Smart Component** :

```typescript
import { LazyArticleEditorComponent } from './components/lazy-article-editor/lazy-article-editor.component';

@Component({
  imports: [LazyArticleEditorComponent, ...]
})
```

---

#### 3ï¸âƒ£ **Dossier `services/`** - Services mÃ©tier

**Structure** : Un dossier par service

```
services/
â”œâ”€â”€ [service-name]/
â”‚   â”œâ”€â”€ [service-name].service.ts
â”‚   â””â”€â”€ [service-name].service.spec.ts
â”œâ”€â”€ [autre-service]/
â”‚   â””â”€â”€ ...
```

**Convention de nommage** :

- Dossier : `kebab-case` (ex: `openai-api/`)
- Service : `PascalCase` + `.service.ts` (ex: `OpenaiApiService`)

**Exemple** :

```
services/
â”œâ”€â”€ openai-api/
â”‚   â”œâ”€â”€ openai-api.service.ts
â”‚   â””â”€â”€ openai-api.service.spec.ts
â”œâ”€â”€ video/
â”‚   â”œâ”€â”€ video.service.ts
â”‚   â””â”€â”€ video.service.spec.ts
â””â”€â”€ image-upload/
    â”œâ”€â”€ image-upload.service.ts
    â””â”€â”€ image-upload.service.spec.ts
```

**CaractÃ©ristiques** :

- âœ… Services **Injectable** avec `providedIn: 'root'`
- âœ… ResponsabilitÃ© unique
- âœ… Testables (injection de dÃ©pendances)
- âœ… Peuvent utiliser des services `shared/`

**Exemple** :

```typescript
@Injectable({ providedIn: "root" })
export class OpenaiApiService {
  private readonly supabaseService = inject(SupabaseService);

  generateArticle(idea: string): Observable<string> {
    // Logique mÃ©tier spÃ©cifique
  }
}
```

---

#### 4ï¸âƒ£ **Dossier `store/`** - Ã‰tat global

**Fichier** : `store/index.ts`

**ResponsabilitÃ©** :

- âœ… Ã‰tat global de la feature
- âœ… MÃ©thodes rÃ©actives avec `rxMethod`
- âœ… Validation avant chaque opÃ©ration
- âœ… Gestion d'erreurs centralisÃ©e

**Structure** :

```typescript
// store/index.ts
export interface FeatureState {
  // Ã‰tat de la feature
  isLoading: boolean;
  error: string[];
  // ... autres propriÃ©tÃ©s
}

export const FeatureStore = signalStore(
  { providedIn: "root" },
  withState(initialState),
  withComputed((state) => ({
    // Computed signals
  })),
  withMethods((store, infra = inject(Infrastructure)) => ({
    // MÃ©thodes rÃ©actives
  }))
);
```

**CaractÃ©ristiques** :

- âœ… Store **signalStore** (NgRx Signals)
- âœ… Ã‰tat typÃ© avec interface
- âœ… MÃ©thodes `rxMethod` pour RxJS
- âœ… Validation et gestion d'erreurs

---

#### 5ï¸âƒ£ **Dossier `types/`** - Types TypeScript

**Structure** : Un fichier par type/interface

```
types/
â”œâ”€â”€ post.ts              # Interface Post
â”œâ”€â”€ faq.ts              # Interface FAQ
â”œâ”€â”€ imageChapitre.ts     # Interface ImageChapitre
â””â”€â”€ validationRule.ts    # Interface ValidationRule
```

**Convention** :

- Fichier : `kebab-case.ts`
- Interface : `PascalCase` (ex: `Post`, `FaqItem`)

**Exemple** :

```typescript
// types/post.ts
export interface Post {
  id: number;
  titre: string;
  article: string;
  // ...
}

// types/faq.ts
export interface FaqItem {
  question: string;
  response: string;
}
```

**CaractÃ©ristiques** :

- âœ… Types **exportÃ©s** pour rÃ©utilisation
- âœ… Interfaces strictes (pas de `any`)
- âœ… RegroupÃ©s par domaine mÃ©tier

---

#### 6ï¸âƒ£ **Dossier `utils/`** - Utilitaires

**Structure** : Un fichier par utilitaire

```
utils/
â”œâ”€â”€ slug-formatter.ts
â”œâ”€â”€ slug-formatter.spec.ts
â”œâ”€â”€ cleanJsonObject.ts
â”œâ”€â”€ cleanJsonObject.spec.ts
â””â”€â”€ getFormattedDate.ts
```

**Convention** :

- Fichier : `kebab-case.ts`
- Fonction : `camelCase` (ex: `formatSlug()`)

**Exemple** :

```typescript
// utils/slug-formatter.ts
export function formatSlug(text: string): string {
  return text
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-|-$/g, "");
}

// utils/cleanJsonObject.ts
export function parseJsonSafe<T>(json: string): T | null {
  try {
    return JSON.parse(json);
  } catch {
    return null;
  }
}
```

**CaractÃ©ristiques** :

- âœ… Fonctions **pures** (pas d'effets de bord)
- âœ… Testables (tests unitaires)
- âœ… RÃ©utilisables dans la feature
- âœ… Peuvent Ãªtre partagÃ©es dans `shared/utils/` si nÃ©cessaires

---

### ğŸ“ Exemple complet : Feature `create`

```
src/app/features/create/
â”‚
â”œâ”€â”€ create.component.ts              # ğŸ¯ Smart Component
â”œâ”€â”€ create.component.html
â”œâ”€â”€ create.component.css
â”œâ”€â”€ create.component.spec.ts
â”‚
â”œâ”€â”€ components/                        # ğŸ“¦ Composants
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ application.ts            # Orchestration mÃ©tier
â”‚   â”‚   â””â”€â”€ application.spec.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ infrastructure.ts         # Wrapper API
â”‚   â”‚   â””â”€â”€ infrastructure.spec.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ article-editor/               # Composant UI
â”‚   â”‚   â”œâ”€â”€ article-editor.component.ts
â”‚   â”‚   â”œâ”€â”€ article-editor.component.html
â”‚   â”‚   â”œâ”€â”€ article-editor.component.css
â”‚   â”‚   â””â”€â”€ article-editor.component.spec.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ error-display/                # Composant UI
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ lazy-article-editor/          # Lazy loading
â”‚       â””â”€â”€ lazy-article-editor.component.ts
â”‚
â”œâ”€â”€ services/                          # ğŸ”§ Services mÃ©tier
â”‚   â”œâ”€â”€ openai-api/
â”‚   â”‚   â”œâ”€â”€ openai-api.service.ts
â”‚   â”‚   â””â”€â”€ openai-api.service.spec.ts
â”‚   â”œâ”€â”€ video/
â”‚   â”‚   â”œâ”€â”€ video.service.ts
â”‚   â”‚   â””â”€â”€ video.service.spec.ts
â”‚   â””â”€â”€ [autres services...]
â”‚
â”œâ”€â”€ store/                             # ğŸ—„ï¸ Store
â”‚   â””â”€â”€ index.ts                       # SearchStore
â”‚
â”œâ”€â”€ types/                              # ğŸ“ Types
â”‚   â”œâ”€â”€ post.ts
â”‚   â”œâ”€â”€ faq.ts
â”‚   â”œâ”€â”€ imageChapitre.ts
â”‚   â””â”€â”€ validationRule.ts
â”‚
â””â”€â”€ utils/                              # ğŸ› ï¸ Utilitaires
    â”œâ”€â”€ slug-formatter.ts
    â”œâ”€â”€ slug-formatter.spec.ts
    â”œâ”€â”€ cleanJsonObject.ts
    â””â”€â”€ cleanJsonObject.spec.ts
```

---

### âœ… Avantages de cette structure

1. **ModularitÃ©**

   - Chaque feature est autonome
   - Facile Ã  dÃ©placer ou supprimer
   - RÃ©utilisable dans d'autres projets

2. **MaintenabilitÃ©**

   - Structure claire et prÃ©visible
   - Facile de trouver le code
   - SÃ©paration des responsabilitÃ©s

3. **TestabilitÃ©**

   - Chaque Ã©lÃ©ment est testable isolÃ©ment
   - Services injectables facilement mockables
   - Composants standalone testables

4. **ScalabilitÃ©**

   - Facile d'ajouter de nouvelles features
   - Pattern rÃ©pÃ©table
   - Ã‰volution progressive

5. **Performance**
   - Lazy loading des composants
   - Computed signals pour optimiser
   - ParallÃ©lisation des appels API

---

### ğŸ¯ Checklist pour crÃ©er une nouvelle feature

- [ ] CrÃ©er le dossier `src/app/features/[feature-name]/`
- [ ] CrÃ©er le Smart Component `[feature-name].component.ts`
- [ ] CrÃ©er le dossier `components/` avec :
  - [ ] `application/application.ts` (orchestration)
  - [ ] `infrastructure/infrastructure.ts` (wrapper API)
  - [ ] Composants UI nÃ©cessaires
- [ ] CrÃ©er le dossier `services/` avec les services mÃ©tier
- [ ] CrÃ©er le dossier `store/` avec `index.ts` (store NgRx Signals)
- [ ] CrÃ©er le dossier `types/` avec les interfaces TypeScript
- [ ] CrÃ©er le dossier `utils/` avec les utilitaires
- [ ] Ajouter la route dans `app.routes.ts` avec lazy loading

---
