<div [formGroup]="form" class="case-vide-form">
  <div class="form-group">
    <label for="texte">Texte avec cases vides *</label>
    <p class="hint">
      Écrivez les mots entre crochets [mot] dans votre texte. Ils seront
      automatiquement extraits comme réponses correctes.
    </p>
    <textarea
      id="texte"
      formControlName="texte"
      rows="6"
      (input)="onTexteChange()"
      placeholder="Ex: Le matin, le petit [chat] boit son bol de [lait]. Ensuite, il joue avec une [balle] dans le jardin."
    ></textarea>
    @if (form.get('texte')?.hasError('required') && form.get('texte')?.touched)
    {
    <span class="error-message"> Le texte est requis. </span>
    }
  </div>

  @if (extractedWords.length > 0) {
  <div class="form-group">
    <div class="section-title">Mots extraits automatiquement</div>
    <div class="extracted-words-list">
      @for (item of extractedWords; track item.index) {
      <div class="extracted-word-item">
        <span class="word-index">[{{ item.index }}]</span>
        <span class="word-value">{{ item.word }}</span>
      </div>
      }
    </div>
  </div>
  }

  <div class="form-group">
    <div class="section-title">Mots leurres (optionnels)</div>
    <p class="hint">
      Ajoutez des mots supplémentaires pour augmenter la difficulté. Ces mots
      apparaîtront dans la banque mais ne sont pas des réponses correctes.
    </p>
    <div formArrayName="mots_leurres" class="leurres-list">
      @for (mot of motsLeurresArray.controls; track $index) {
      <div class="mot-row">
        <input
          type="text"
          [formControlName]="$index"
          [placeholder]="'Mot leurre ' + ($index + 1)"
          class="mot-input"
        />
        <button
          type="button"
          class="btn btn-danger btn-small"
          (click)="removeMotLeurre($index)"
        >
          ×
        </button>
      </div>
      }
    </div>
    <button
      type="button"
      class="btn btn-secondary btn-small"
      (click)="addMotLeurre()"
    >
      + Ajouter un mot leurre
    </button>
  </div>

  @if (form.get('texte')?.value) {
  <div class="preview">
    <strong>Aperçu:</strong>
    <div class="preview-text" [innerHTML]="getPreviewText()"></div>
  </div>
  }
</div>
