<div [formGroup]="form" class="game-global-fields" (click)="$event.stopPropagation()">
  <div class="form-group">
    <label for="instructions">Instructions</label>
    <textarea 
      id="instructions"
      class="form-control"
      rows="2"
      formControlName="instructions"
      placeholder="Instructions pour l'élève"
      (click)="$event.stopPropagation()"
      (focus)="$event.stopPropagation()"
      (input)="$event.stopPropagation()"></textarea>
  </div>

  <div class="form-group">
    <label for="question">Question</label>
    <input 
      id="question"
      type="text"
      class="form-control"
      formControlName="question"
      placeholder="Question du jeu">
  </div>

  <div class="form-group">
    <label for="aides">Aides</label>
    @for (aideControl of aidesArray.controls; track $index) {
      <div class="aide-item">
        <input 
          type="text"
          class="form-control"
          [id]="'aide-' + $index"
          [formControl]="aideControl"
          placeholder="Aide {{ $index + 1 }}">
        <button 
          type="button"
          class="btn btn-danger btn-sm"
          (click)="removeAide($index)"
          aria-label="Supprimer l'aide {{ $index + 1 }}">
          ✕
        </button>
      </div>
    }
    <button 
      type="button"
      class="btn btn-secondary btn-sm"
      (click)="addAide()">
      + Ajouter une aide
    </button>
  </div>

  <!-- Médias d'aide -->
  <div class="form-group">
    <label>Médias d'aide</label>
    
    <!-- Upload d'image d'aide -->
    <div class="aide-media-section">
      <label for="aide-image-input" class="aide-media-label">Image d'aide</label>
      <input 
        id="aide-image-input"
        type="file"
        accept="image/jpeg,image/jpg,image/png,image/webp,image/gif"
        (change)="onAideImageSelected($event)"
        class="file-input">
      
      @if (aideImagePreview) {
        <div class="aide-image-preview">
          <img [src]="aideImagePreview" alt="Aperçu image d'aide" class="preview-image">
          <button 
            type="button"
            class="btn btn-danger btn-sm remove-image-btn"
            (click)="removeAideImage()"
            aria-label="Supprimer l'image d'aide">
            ✕ Supprimer l'image
          </button>
        </div>
      }
    </div>

    <!-- Lien vidéo d'aide -->
    <div class="aide-media-section">
      <label for="aide-video-url">Lien vidéo d'aide (YouTube, Vimeo, etc.)</label>
      <input 
        id="aide-video-url"
        type="text"
        class="form-control"
        formControlName="aideVideoUrl"
        placeholder="https://www.youtube.com/watch?v=... ou https://vimeo.com/...">
      @if (form.get('aideVideoUrl')?.hasError('invalidVideoUrl') && form.get('aideVideoUrl')?.touched) {
        <small class="error-message">URL vidéo invalide. Veuillez entrer un lien YouTube, Vimeo ou autre plateforme vidéo valide.</small>
      }
    </div>
  </div>
</div>

