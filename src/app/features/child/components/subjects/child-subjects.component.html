<div class="child-subjects-container" *ngIf="child() as c">
  <header class="subjects-header">
    <a routerLink="/dashboard" class="btn-back">
      ‚Üê Retour au dashboard
    </a>
    <h1>Mati√®res de {{ c.firstname }} {{ c.lastname }}</h1>
  </header>

  <main class="subjects-content">
    <div class="child-info-card">
      <div class="info-item">
        <span class="info-label">√âcole:</span>
        <span class="info-value">{{ schoolName() || c.school_id || 'Non renseign√©e' }}</span>
      </div>
      <div class="info-item" *ngIf="c.school_level">
        <span class="info-label">Niveau:</span>
        <span class="info-value">{{ getSchoolLevelLabel(c.school_level) }}</span>
      </div>
    </div>

    <div class="subjects-grid">
      <div class="subjects-column active-column">
        <div class="column-header">
          <h2>üìñ Mati√®res activ√©es</h2>
          <span class="count-badge">{{ selectedSubjects().length }}</span>
        </div>
        <div class="subjects-list">
          <div *ngFor="let s of selectedSubjects()" class="subject-card active">
            <label class="subject-checkbox">
              <input type="checkbox" [checked]="true" (change)="onToggle(s.id, false)">
              <span class="checkmark"></span>
              <span class="subject-name">{{ s.name }} <span class="subject-type-badge">({{ s.type }})</span><span *ngIf="getSchoolLevelForSubject(s.id)" class="school-level-badge"> - {{ getSchoolLevelForSubject(s.id) }}</span></span>
              <span *ngIf="isUnofficial(s.id)" class="unofficial-badge">(hors programme)</span>
            </label>
            <app-games-stats-display [subjectId]="s.id"></app-games-stats-display>
          </div>
          <div *ngIf="selectedSubjects().length === 0" class="empty-state">
            <p class="muted">Aucune mati√®re activ√©e.</p>
          </div>
        </div>
      </div>

      <div class="subjects-column available-column">
        <div class="column-header">
          <h2>üìö Mati√®res disponibles</h2>
          <span class="count-badge">{{ unselectedSubjects().length }}</span>
        </div>
        <div class="subjects-list">
          <div *ngFor="let s of unselectedSubjects()" class="subject-card">
            <label class="subject-checkbox">
              <input type="checkbox" [checked]="false" (change)="onToggle(s.id, true)">
              <span class="checkmark"></span>
              <span class="subject-name">{{ s.name }} <span class="subject-type-badge">({{ s.type }})</span><span *ngIf="getSchoolLevelForSubject(s.id)" class="school-level-badge"> - {{ getSchoolLevelForSubject(s.id) }}</span></span>
            </label>
            <app-games-stats-display [subjectId]="s.id"></app-games-stats-display>
          </div>
          <div *ngIf="unselectedSubjects().length === 0" class="empty-state">
            <p class="muted">Aucune autre mati√®re disponible.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="search-block">
      <div class="search-header">
        <h3>üîç Ajouter une autre mati√®re</h3>
        <p class="search-hint">Recherchez une mati√®re pour l'ajouter hors programme</p>
      </div>
      <div class="search-input-wrapper">
        <input 
          type="text" 
          class="search-input"
          placeholder="Rechercher une mati√®re (min 2 lettres)..." 
          [value]="searchQuery()" 
          (input)="onSearchInput($any($event.target).value)">
      </div>
      <div *ngIf="searchQuery().trim().length >= 2" class="search-results">
        <div *ngIf="searchResults().length > 0">
          <div *ngFor="let s of searchResults()" class="search-result-item">
            <span class="result-name">{{ s.name }} <span class="subject-type-badge">({{ s.type }})</span><span *ngIf="s.school_level" class="school-level-badge"> - {{ getSchoolLevelLabel(s.school_level) }}</span></span>
            <button 
              type="button" 
              class="btn btn-primary btn-sm" 
              (click)="addSearchedSubject(s.id)">
              ‚ûï Activer (hors programme)
            </button>
          </div>
        </div>
        <div *ngIf="searchResults().length === 0 && searchQuery().trim().length >= 2" class="no-results">
          <p class="muted">Aucune mati√®re trouv√©e pour "{{ searchQuery() }}"</p>
        </div>
      </div>
    </div>
  </main>
</div>


