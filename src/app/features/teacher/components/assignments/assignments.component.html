<div class="assignment-section">
  <button 
    *ngIf="!showAssignmentForm()"
    type="button" 
    (click)="showAssignmentForm.set(true)" 
    class="btn btn-primary">
    ‚ûï Ajouter une affectation
  </button>

  <div *ngIf="showAssignmentForm()" class="assignment-form-container">
    <h3>Nouvelle Affectation</h3>
    <form [formGroup]="assignmentForm" (ngSubmit)="onSubmitAssignment()">
      <div class="form-group">
        <label for="school_id">√âcole *</label>
        <select 
          id="school_id" 
          formControlName="school_id"
          (change)="onSchoolChange($any($event.target).value)"
          [class.error]="assignmentForm.get('school_id')?.invalid && assignmentForm.get('school_id')?.touched">
          <option value="">S√©lectionner une √©cole</option>
          <option *ngFor="let school of schools()" [value]="school.id">{{ school.name }}</option>
        </select>
        <button type="button" (click)="showCreateSchool.set(true)" class="btn btn-secondary btn-sm">‚ûï Cr√©er une √©cole</button>
      </div>

      <div *ngIf="showCreateSchool()" class="nested-form">
        <h4>Cr√©er une nouvelle √©cole</h4>
        <form [formGroup]="schoolForm" (ngSubmit)="onCreateSchool()">
          <div class="form-group">
            <label for="school_name">Nom de l'√©cole *</label>
            <input id="school_name" type="text" formControlName="name">
          </div>
          <div class="form-group">
            <label for="school_address">Adresse</label>
            <input id="school_address" type="text" formControlName="address">
          </div>
          <div class="form-group">
            <label for="school_city">Ville</label>
            <input id="school_city" type="text" formControlName="city">
          </div>
          <div class="form-group">
            <label for="school_country">Pays</label>
            <input id="school_country" type="text" formControlName="country">
          </div>
          <div class="form-actions">
            <button type="submit" [disabled]="schoolForm.invalid || creatingSchool()" class="btn btn-primary">Cr√©er</button>
            <button type="button" (click)="showCreateSchool.set(false)" class="btn btn-secondary">Annuler</button>
          </div>
        </form>
      </div>

      <div class="form-group">
        <app-school-level-select
          [label]="'Niveau scolaire'"
          [required]="true"
          formControlName="school_level"
        />
      </div>

      <div class="form-group">
        <label for="subject_id">Mati√®re *</label>
        <select 
          id="subject_id" 
          formControlName="subject_id"
          [class.error]="assignmentForm.get('subject_id')?.invalid && assignmentForm.get('subject_id')?.touched">
          <option value="">S√©lectionner une mati√®re</option>
          <option *ngFor="let subject of subjects()" [value]="subject.id">{{ subject.name }} ({{ subject.type }})</option>
        </select>
        <button type="button" (click)="showCreateSubject.set(true)" class="btn btn-secondary btn-sm">‚ûï Cr√©er une mati√®re</button>
      </div>

      <div *ngIf="showCreateSubject()" class="nested-form">
        <h4>Cr√©er une nouvelle mati√®re</h4>
        <form [formGroup]="subjectForm" (ngSubmit)="onCreateSubject()">
          <div class="form-group">
            <label for="subject_name">Nom de la mati√®re *</label>
            <input id="subject_name" type="text" formControlName="name">
          </div>
          <div class="form-group">
            <label for="subject_description">Description</label>
            <textarea id="subject_description" formControlName="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="subject_type">Type *</label>
            <select id="subject_type" formControlName="type">
              <option value="scolaire">Scolaire</option>
              <option value="extra">Extra-scolaire</option>
              <option value="optionnelle">Optionnelle</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="submit" [disabled]="subjectForm.invalid || creatingSubject()" class="btn btn-primary">Cr√©er</button>
            <button type="button" (click)="showCreateSubject.set(false)" class="btn btn-secondary">Annuler</button>
          </div>
        </form>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="assignmentForm.invalid || isLoading()" class="btn btn-primary">
          Ajouter l'affectation
        </button>
        <button type="button" (click)="showAssignmentForm.set(false)" class="btn btn-secondary">
          Annuler
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="hasAssignments()" class="assignments-list">
    <div *ngFor="let assignment of assignments()" class="assignment-card">
      <div class="assignment-info">
        <h4>{{ getAssignmentSubjectName(assignment) }}</h4>
        <p *ngIf="assignment.school_id">√âcole: {{ getSchoolName(assignment.school_id) }}</p>
        <p *ngIf="assignment.school_level">Niveau: {{ assignment.school_level }}</p>
      </div>
      <div class="assignment-actions">
        <button type="button" (click)="onDeleteAssignment(assignment.id)" class="btn btn-danger btn-sm">
          üóëÔ∏è Supprimer
        </button>
      </div>
    </div>
  </div>
</div>

