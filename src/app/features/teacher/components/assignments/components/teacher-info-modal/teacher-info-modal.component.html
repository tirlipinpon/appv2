<div 
  class="modal-backdrop" 
  (click)="onBackdropClick($event)"
  (keydown.escape)="onClose()"
  tabindex="0"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 id="modal-title">ğŸ‘¨â€ğŸ« Informations du professeur</h3>
      <button type="button" class="close-btn" (click)="onClose()" (keydown.enter)="onClose()" aria-label="Fermer">Ã—</button>
    </div>

    <div class="modal-body">
      <div *ngIf="loading()" class="loading">
        <p>Chargement des informations...</p>
      </div>

      <div *ngIf="error()" class="error-message">
        <p>âš ï¸ {{ error() }}</p>
      </div>

      <div *ngIf="!loading() && !error() && teacher()" class="teacher-info">
        <div class="teacher-header">
          <div class="teacher-avatar">
            <span *ngIf="!teacher()?.avatar_url">{{ (teacher()?.fullname || teacherName || '?')[0].toUpperCase() }}</span>
            <img *ngIf="teacher()?.avatar_url" [src]="teacher()?.avatar_url" [alt]="teacher()?.fullname || 'Professeur'">
          </div>
          <div class="teacher-name-section">
            <h4>{{ teacher()?.fullname || teacherName || 'Professeur sans nom' }}</h4>
            <p *ngIf="subjectName" class="subject-context">Professeur de "{{ subjectName }}"</p>
          </div>
        </div>

        <div class="teacher-details">
          <div class="detail-section">
            <strong>ğŸ“ Biographie :</strong>
            <p *ngIf="teacher()?.bio">{{ teacher()?.bio }}</p>
            <p *ngIf="!teacher()?.bio" class="no-info">Aucune biographie renseignÃ©e.</p>
          </div>

          <div class="detail-section">
            <strong>ğŸ“§ Email :</strong>
            <p *ngIf="teacherEmail() && teacher()?.share_email">
              <a [href]="'mailto:' + teacherEmail()" class="email-link">{{ teacherEmail() }}</a>
            </p>
            <p *ngIf="teacherEmail() && !teacher()?.share_email" class="no-info">Email non partagÃ© par le professeur.</p>
            <p *ngIf="!teacherEmail()" class="no-info">Email non disponible.</p>
          </div>

          <div class="detail-section">
            <strong>ğŸ“ TÃ©lÃ©phone :</strong>
            <p *ngIf="teacher()?.phone && teacher()?.share_phone">{{ teacher()?.phone }}</p>
            <p *ngIf="teacher()?.phone && !teacher()?.share_phone" class="no-info">TÃ©lÃ©phone non partagÃ© par le professeur.</p>
            <p *ngIf="!teacher()?.phone" class="no-info">Aucun tÃ©lÃ©phone renseignÃ©.</p>
          </div>

          <div class="detail-section">
            <strong>ğŸ–¼ï¸ Avatar :</strong>
            <div *ngIf="teacher()?.avatar_url" class="avatar-preview">
              <img [src]="teacher()?.avatar_url" [alt]="teacher()?.fullname || 'Avatar'" class="avatar-image">
              <a [href]="teacher()?.avatar_url" target="_blank" rel="noopener noreferrer" class="avatar-link">
                {{ teacher()?.avatar_url }}
              </a>
            </div>
            <p *ngIf="!teacher()?.avatar_url" class="no-info">Aucun avatar renseignÃ©.</p>
          </div>

          <div *ngIf="assignments().length > 0" class="detail-section">
            <strong>ğŸ“š Affectations pour cette matiÃ¨re :</strong>
            <div class="assignments-list">
              <div *ngFor="let assignment of assignments()" class="assignment-item">
                <span *ngIf="assignment.school_id">ğŸ“ Ã‰cole: {{ getSchoolName(assignment.school_id) }}</span>
                <span *ngIf="assignment.school_level">ğŸ“ Niveau: {{ getSchoolLevelLabel(assignment.school_level) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!loading() && !error() && !teacher()" class="empty-state">
        <p>Informations du professeur non disponibles.</p>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="onClose()">Fermer</button>
    </div>
  </div>
</div>

