<li class="game-item" [class.editing]="isEditing()">
  <div class="game-header">
    <h4>{{ game.name }}</h4>
    <span class="game-type-badge">{{ currentGameTypeName() }}</span>
  </div>

  <!-- Mode lecture -->
  @if (!isEditing()) {
    <div class="game-preview">
      <div class="game-content">
        @if (game.question) {
          <h4 class="game-question">{{ game.question }}</h4>
        }
        @if (game.instructions) {
          <p class="game-instructions">{{ game.instructions }}</p>
        }
        
        <div class="game-metadata">
          <strong>Contenu:</strong> {{ formatMetadataForDisplay() }}
        </div>

        @if (game.aides && game.aides.length > 0) {
          <div class="game-aides">
            <strong>Aides ({{ game.aides.length }}):</strong>
            <ul>
              @for (aide of game.aides; track aide) {
                <li>{{ aide }}</li>
              }
            </ul>
          </div>
        }
      </div>

      <div class="game-actions">
        <button class="btn btn-secondary" (click)="toggleEdit()">
          ‚úèÔ∏è Modifier
        </button>
        <button class="btn btn-danger" (click)="onDeleteClick()">
          üóëÔ∏è Supprimer
        </button>
      </div>
    </div>
  }

  <!-- Mode √©dition -->
  @if (isEditing()) {
    <div class="game-edit">
      <div class="edit-notice">
        ‚ö†Ô∏è Mode √©dition - Utilisez le formulaire ci-dessous pour modifier le jeu
      </div>

      <!-- Champs globaux (instructions, question, aides) -->
      <app-game-global-fields
        [initialData]="initialGlobalFields()"
        (dataChange)="onGlobalFieldsChange($event)"
        (validityChange)="onGlobalFieldsValidityChange()">
      </app-game-global-fields>

      <hr class="form-divider">

      <!-- Formulaires sp√©cifiques pour chaque type -->
      @if (currentGameTypeName().toLowerCase() === 'qcm') {
        <app-qcm-form 
          [initialData]="getInitialDataForQcm()"
          (dataChange)="onGameDataChange($event)"
          (validityChange)="onGameValidityChange($event)">
        </app-qcm-form>
      }

      @if (currentGameTypeName().toLowerCase() === 'case vide') {
        <app-case-vide-form 
          [initialData]="getInitialDataForCaseVide()"
          (dataChange)="onGameDataChange($event)"
          (validityChange)="onGameValidityChange($event)">
        </app-case-vide-form>
      }

      @if (currentGameTypeName().toLowerCase() === 'reponse libre') {
        <app-reponse-libre-form 
          [initialData]="getInitialDataForReponseLibre()"
          (dataChange)="onGameDataChange($event)"
          (validityChange)="onGameValidityChange($event)">
        </app-reponse-libre-form>
      }

      @if (currentGameTypeName().toLowerCase() === 'liens') {
        <app-liens-form 
          [initialData]="getInitialDataForLiens()"
          (dataChange)="onGameDataChange($event)"
          (validityChange)="onGameValidityChange($event)">
        </app-liens-form>
      }

      @if (currentGameTypeName().toLowerCase() === 'chronologie') {
        <app-chronologie-form 
          [initialData]="getInitialDataForChronologie()"
          (dataChange)="onGameDataChange($event)"
          (validityChange)="onGameValidityChange($event)">
        </app-chronologie-form>
      }

      <div class="edit-actions">
        <button class="btn btn-primary" (click)="saveEdit()" [disabled]="!gameSpecificValid()">
          ‚úÖ Enregistrer
        </button>
        <button class="btn btn-info" (click)="openPreview()" [disabled]="!gameSpecificValid()">
          üëÅÔ∏è Pr√©visualiser
        </button>
        <button class="btn btn-secondary" (click)="cancelEdit()">
          ‚ùå Annuler
        </button>
      </div>
    </div>
  }
</li>

<!-- Pr√©visualisation du jeu -->
<app-game-preview
  [isOpen]="previewIsOpen()"
  [gameTypeName]="currentGameTypeName()"
  [globalFields]="currentGlobalFields()"
  [gameData]="gameSpecificData()"
  (closed)="closePreview()">
</app-game-preview>

