<div class="reponse-libre-game">
  @if (instructions) {
    <div class="game-instructions">
      <p>{{ instructions }}</p>
    </div>
  }
  @if (question) {
    <div class="game-question">
      <h2>{{ question }}</h2>
    </div>
  }
  @if (aides && aides.length > 0) {
    <div class="aides-toggle-container">
      <button 
        type="button"
        class="aides-toggle-btn"
        (click)="toggleAides()"
        [attr.aria-expanded]="showAides()"
        [attr.aria-label]="showAides() ? 'Masquer aide' : 'Afficher aide'">
        <span class="toggle-icon">{{ showAides() ? '−' : '+' }}</span>
        <span class="toggle-text">{{ showAides() ? 'Masquer aide' : 'Afficher aide' }}</span>
      </button>
      @if (showAides()) {
        <div class="aides-container">
          <strong>Aide :</strong>
          <ul>
            @for (aide of aides; track $index) {
              <li>{{ aide }}</li>
            }
          </ul>
        </div>
      }
    </div>
  }
  
  <div class="reponse-libre-container">
    <app-letter-by-letter-input
      [targetWord]="getReponseValide()"
      [allowHyphen]="true"
      [disabled]="disabled || isSubmitted()"
      (wordChange)="onWordChange($event)"
      (wordComplete)="onWordComplete()">
    </app-letter-by-letter-input>
  </div>

  @if (!isSubmitted()) {
    <div class="actions">
      <button 
        class="btn btn-primary" 
        (click)="validate()" 
        [disabled]="!canValidate() || disabled">
        Valider
      </button>
    </div>
  }

  @if (isSubmitted() && showResult && isCorrect()) {
    <div class="result-message correct">
      ✅ Bonne réponse !
    </div>
  }

  @if (isSubmitted() && showResult && !isCorrect()) {
    <div class="result-message incorrect">
      ❌ Mauvaise réponse. La bonne réponse était : "{{ getReponseValide() }}"
    </div>
  }

  <app-game-error-actions
    [isSubmitted]="isSubmitted()"
    [isCorrect]="isCorrect()"
    (resetRequested)="reset()"
    (nextRequested)="nextRequested.emit()">
  </app-game-error-actions>
</div>
