<div class="case-vide-game">
  @if (instructions) {
  <div class="game-instructions">
    <p>{{ instructions }}</p>
  </div>
  } @if (question) {
  <div class="game-question">
    <h2>{{ question }}</h2>
  </div>
  }
  <app-aide-section
    [aides]="aides"
    [aideImageUrl]="aideImageUrl"
    [aideVideoUrl]="aideVideoUrl">
  </app-aide-section> @if (caseVideData.texte && caseVideData.banque_mots) {
  <!-- Nouveau format : Drag and Drop -->
  @if ((showResult || isSubmitted()) && isCorrect() !== null) {
  <div
    class="result-message"
    [class.correct]="isCorrect()"
    [class.incorrect]="!isCorrect()"
  >
    @if (isCorrect()) { ✅ Toutes les réponses sont correctes ! } @else { ❌
    Certaines réponses sont incorrectes. }
  </div>
  }

  <!-- Banque de mots -->
  <div class="banque-mots-container">
    <h4>Banque de mots</h4>
    <div
      cdkDropList
      id="banque-mots"
      class="banque-mots-list"
      [cdkDropListData]="availableWords()"
      [cdkDropListConnectedTo]="connectedDropListIds()"
    >
      @for (word of availableWords(); track word.id) {
        @if (!isWordUsed(word)) {
          <div
            class="word-tag"
            cdkDrag
            [cdkDragData]="word"
            [attr.data-word-id]="word.id"
          >
            <!-- Placeholder personnalisé -->
            <ng-template cdkDragPlaceholder>
              <div class="word-tag placeholder">
                <span class="word-text">{{ word.word }}</span>
              </div>
            </ng-template>
            
            <!-- Contenu normal -->
            <span class="word-text">{{ word.word }}</span>
          </div>
        }
      }
    </div>
  </div>

  <!-- Texte avec cases vides -->
  <div class="texte-with-cases">
    @for (part of parseTexteWithCasesParts(); track $index) { @if (part.type ===
    'text') {
    <span class="texte-part">{{ part.content }}</span>
    } @else if (part.type === 'case' && part.uniqueId && part.index !== undefined) {
    <span
      cdkDropList
      [id]="part.uniqueId"
      class="case-vide-drop"
      [cdkDropListData]="getCaseDropListData(part.uniqueId)"
      [cdkDropListConnectedTo]="connectedDropListIds()"
      (cdkDropListDropped)="onWordDrop($event, part.uniqueId!)"
      [class.filled]="getWordInCase(part.index)"
      [class.correct]="
        isCaseCorrect(part.index) === true && isCorrect() === true
      "
      [class.incorrect]="isCaseCorrect(part.index) === false"
    >
      @if (getWordInCase(part.index)) { @for (wordInstance of
      getCaseDropListData(part.uniqueId!); track wordInstance.id) {
      <span
        class="case-word"
        [class.correct-word]="
          isCaseCorrect(part.index) === true && isCorrect() === true
        "
        [class.incorrect-word]="isCaseCorrect(part.index) === false"
        cdkDrag
        [cdkDragData]="wordInstance"
        [attr.data-word-id]="wordInstance.id"
      >
        <!-- Placeholder personnalisé -->
        <ng-template cdkDragPlaceholder>
          <span class="case-word placeholder">
            <span class="word-text">{{ wordInstance.word }}</span>
          </span>
        </ng-template>
        
        <!-- Contenu normal -->
        <span class="word-text">{{ wordInstance.word }}</span>
        @if (!isSubmitted() && !disabled) {
        <button
          type="button"
          class="btn-remove-word"
          (click)="removeWordFromCase(part.uniqueId!); $event.stopPropagation()"
          title="Retirer ce mot"
        >
          ×
        </button>
        }
      </span>
      } } @else {
      <span class="case-placeholder">{{ part.content }}</span>
      }
    </span>
    } }
  </div>
  } @else {
  <!-- Ancien format : Input texte simple -->
  @if ((showResult || isSubmitted()) && isCorrect() !== null) {
  <div
    class="result-message"
    [class.correct]="isCorrect()"
    [class.incorrect]="!isCorrect()"
  >
    @if (isCorrect()) { ✅ Bonne réponse ! } @else { ❌ Mauvaise réponse. }
  </div>
  }
  <div class="case-vide-sentence">
    <span>{{ caseVideData.debut_phrase }}</span>
    <input
      type="text"
      [value]="caseVideUserAnswer()"
      (input)="caseVideUserAnswer.set($any($event.target).value)"
      [disabled]="disabled || isSubmitted()"
      placeholder="?"
      class="case-vide-input"
    />
    <span>{{ caseVideData.fin_phrase }}</span>
  </div>
  }

  <app-game-error-actions
    [isSubmitted]="isSubmitted()"
    [isCorrect]="isCorrect()"
    (resetRequested)="onResetRequested()"
    (nextRequested)="nextRequested.emit()"
  >
  </app-game-error-actions>

</div>
